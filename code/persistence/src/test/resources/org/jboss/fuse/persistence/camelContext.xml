<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:jdbc="http://www.springframework.org/schema/jdbc"
       xsi:schemaLocation="
       http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://camel.apache.org/schema/spring
       http://camel.apache.org/schema/spring/camel-spring.xsd
       http://www.springframework.org/schema/jdbc
       http://www.springframework.org/schema/jdbc/spring-jdbc.xsd
    ">


    <camelContext id="camel" xmlns="http://camel.apache.org/schema/spring">

        <!-- Route which will execute the select query every 20s and display result in the log-->
        <route id="trigger-database">
            <from uri="direct://hello"/>
            <to uri="jdbc:testdb?readSize=100"/>
            <split>
                <simple>${body}</simple>
                <log message="*** Select all : ${body}"/>
            </split>
        </route>

        <!-- Route which will execute the select query when a file will be poll from
            data directory. this file contains the keys of the incidents to be find
            and display result in the log -->
        <route id="key-from-file">
            <from uri="file://target/data"/>
            <split>
               <tokenize token=","/>
               <setBody>
                   <simple>SELECT * FROM REPORT.T_INCIDENT WHERE INCIDENT_REF = '${body}' </simple>
               </setBody>
               <log message=">>> SQL Query : ${body}"/>
               <to uri="jdbc:testdb"/>
               <log message=">>> Select using key : ${body}"/>
            </split>
        </route>

    </camelContext>

<!--    &lt;!&ndash; H2 DB &ndash;&gt;
    <bean id="reportdb" class="org.springframework.jdbc.datasource.DriverManagerDataSource">
        <property name="driverClassName" value="org.h2.Driver"/>
        <property name="url" value="jdbc:h2:tcp://localhost/~/reportdb"/>
        <property name="username" value="sa"/>
        <property name="password" value=""/>
    </bean>-->

    <jdbc:embedded-database id="testdb" type="H2">
        <jdbc:script location="classpath:org/jboss/fuse/persistence/sql/h2-jdbc.sql"/>
    </jdbc:embedded-database>



</beans>
